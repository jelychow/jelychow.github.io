---
theme: fancy
highlight: arduino-light
excerpt: "æ·±å…¥è§£æAndroidåº”ç”¨çš„è®¾è®¡ç³»ç»Ÿï¼æ¢è®¨å¦‚ä½•ä½¿ç”¨Material Designå’ŒJetpack Composeåˆ›å»ºä¸€è‡´ã€ç¾è§‚ä¸”é«˜åº¦å¯å¤ç”¨çš„UIç»„ä»¶åº“ã€‚"
---

## å‡†å¤‡å·¥ä½œ

åœ¨å­¦ä¹ æœ¬ç« ä¹‹å‰ä¸ªäººå»ºè®®è§‚çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ä¸­æœ‰å…³ compose theme ç›¸å…³é“¾æ¥ï¼Œæœ‰ä¸ªå¤§æ¦‚çš„å°è±¡å³å¯ã€‚æˆ‘ä¸ªäººä¸å–œæ¬¢åœ¨æ–‡ç« é‡Œé¢å››å¤„å¼•ç”¨å®˜æ–¹æ–‡æ¡£ï¼Œè¿™æ ·äºè‡ªå·±ï¼Œåˆ«äººéƒ½æ˜¯æ— æ„ä¹‰çš„äº‹æƒ…ï¼Œå¸Œæœ›é‡ç‚¹èŠ±åœ¨å¯¹é¡¹ç›®çš„ç†è§£ï¼ŒçŸ¥è¯†åº”ç”¨ä¸Šã€‚
æ–‡æ¡£é“¾æ¥ï¼š

1.  [ä¸»é¢˜è¯¦è§£](https://developer.android.com/develop/ui/compose/designsystems/anatomy?hl=zh-cn)
2.  [ä¸»é¢˜è‡ªå®šä¹‰](https://developer.android.com/develop/ui/compose/designsystems/custom?hl=zh-cn)

## Design system ä¸»è¦ç›®çš„

åœ¨åº”ç”¨å¼€å‘ä¸­ Design system æ˜¯ä¸€ä¸ªéå¸¸è§çš„æ¦‚å¿µã€‚å¾ˆå¤šå¤§å…¬å¸éƒ½æœ‰è‡ªå·±çš„ design systemï¼Œä¾‹å¦‚å¾®è½¯çš„ [FluentUi](https://developer.microsoft.com/en-us/fluentui#/)ï¼Œå°±æ˜¯ä¸€ä¸ªæ¨ªè·¨å¤šç«¯çš„ design systemã€‚é€šè¿‡åº”ç”¨ Design system æœ‰æ•ˆçš„ä¿è¯äº†å¤šç«¯æ ·å¼çš„ç»Ÿä¸€ï¼Œåä½œèµ·æ¥ä¹Ÿæ›´ä¸ºæ–¹ä¾¿ï¼ŒåŒæ—¶ä¹Ÿæ›´æœ‰åˆ©äºè®¾è®¡å¸ˆä¸ç¨‹åºå‘˜ä¹‹é—´çš„æ²Ÿé€šï¼ˆå› ä¸ºæ‰€æœ‰çš„è®¾è®¡èµ„æºéƒ½æ˜¯æ¥è‡ªäºç°æœ‰çš„ç»„ä»¶ï¼Œæ‰€ä»¥å¼€å‘è€…ä¸ç”¨èŠ±å¾ˆå¤šæ—¶é—´å»æƒ³ç€å¦‚ä½•æ„æ€å¸ƒå±€ä¹‹ç±»ï¼‰ã€‚å¦‚æœä¹‹å‰å¯¹äº design system äº†è§£ä¸å¤šï¼Œé‚£ä¹ˆæˆ‘å»ºè®®å¯ä»¥çœ‹çœ‹å¾®è½¯çš„ FluentUiï¼Œç›¸ä¿¡åº”è¯¥å¯ä»¥å­¦åˆ°ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚

## Now In Android é‡Œé¢çš„ design system

### design system ç¤ºæ„å›¾

![image.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/88d2a9099b914b48bdd566f6836c4d62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2FwdGFpblo=:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzU0NDQ4MTIxNzM4MzkxMSJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1741343358&x-orig-sign=rmvdfhLi5VtT%2FY%2FVF4QasbrdHr8%3D)

### design system ç»„æˆ

ä¸€ä¸ª design system ä¸»è¦ç”± componentsï¼Œiconsï¼Œä»¥åŠ theme ç›¸å…³çš„æ–‡ä»¶ç»„æˆã€‚\
é€šå¸¸æ­£ç»çš„å…¬å¸éƒ½æœ‰ä¸€å¥—è‡ªå·±çš„ design systemï¼Œé¦–å…ˆè¿™ä¸ª design system æ˜¯å¤¸ç«¯çš„ï¼Œåœ¨è®¾è®¡ç¨¿ï¼Œå®¢æˆ·ç«¯ï¼Œwebä¸Šé¢ä¼šæœ‰ä¸€äº›å¼€å‘ç”¨åˆ°çš„ componentsï¼Œiconsï¼Œtheme ç›¸å…³çš„é¡µé¢ã€‚åœ¨è®¾è®¡å’Œå¼€å‘è¿‡ç¨‹ä¸­éƒ½ä¼šæŒ‰ç…§ design system ä¸Šé¢çš„ç»„ä»¶ï¼Œtheme è¿›è¡Œè®¾è®¡ï¼Œè¿™æ ·èƒ½å¤Ÿæœ€å¤§ç¨‹åº¦çš„ä¿è¯ä¸‰ç«¯çš„ç¨³å®šæ€§ï¼Œç”¨å·¥ç¨‹çš„æ‰‹æ®µä¿è¯é¡¹ç›®çš„ UI çš„ä¸€è‡´æ€§ã€‚

#### ä¸¾ä¸ªä¾‹å­

å…ˆçœ‹ä¸€ä¸‹ material design çš„ demo è®¾è®¡å›¾

![image.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/8a26604743c84258800824c703ce298d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2FwdGFpblo=:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzU0NDQ4MTIxNzM4MzkxMSJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1741343358&x-orig-sign=VBu5EVhuhiExQtWgPQ84YuHNcGg%3D)

![image.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/e53f71cb16f54533afd1a99ea656a72e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2FwdGFpblo=:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzU0NDQ4MTIxNzM4MzkxMSJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1741343358&x-orig-sign=CjInsagmuk9Bz9K88phCWv51FDw%3D)

ä¸Šé¢çš„è®¾è®¡å›¾æ˜¯ä¸€ä¸ªæŒ‰é’®ç»„ä»¶ï¼Œè¾¹ä¸Šæ˜¯è¿™ä¸ªæŒ‰é’®çš„å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€‰ç”¨çš„æ˜¯ M3 design kit é‡Œé¢çš„ Button è¿™ä¸ªç»„ä»¶ï¼Œä»–çš„ style æ˜¯ filled, ä»–çš„ state æ˜¯ enabledï¼Œshow icon æ˜¯ offï¼Œlabel text æ˜¯ Downloadã€‚åœ¨æ­£å¸¸çš„å¼€å‘æµç¨‹é‡Œé¢æˆ‘ä»¬çš„ç»„ä»¶åº“åº“é‡Œé¢åº”è¯¥æœ‰è¿™ä¸ª Button çš„ç»„ä»¶ï¼Œå¹¶ä¸” style æ–‡ä»¶é‡Œé¢åº”è¯¥æœ‰ filled è¿™ä¸ªæ ·å¼ï¼ŒButton ç»„ä»¶åº”è¯¥æ”¯æŒ enabled å±æ€§ï¼Œæ”¯æŒå±•ç¤ºéšè— iconï¼Œå¹¶ä¸”æ”¯æŒæ ‡ç­¾å±•ç¤ºã€‚åœ¨è¿™é‡Œå°±ä¼šæœ‰å¥½å¥‡å®å®æé—®äº†ï¼Œæˆ‘ iOS ä¸æ”¯æŒå’‹åŠï¼Œæˆ‘ web button æ²¡æœ‰ icon åŠŸèƒ½å’‹åŠï¼Œè¿™é‡Œé€šå¸¸æ¥è¯´éœ€è¦æ¯ä¸€ç«¯ï¼ˆå°¤å…¶æ˜¯è®¾è®¡ç«¯ï¼‰å»è¡¥ä¸Šè¿™ä¸ª componentã€‚è¿™æ ·çš„æ–¹å¼çœ‹èµ·æ¥å‰æœŸä¼šå¾ˆéº»çƒ¦ï¼Œå› ä¸ºä¸€ä¸ªæ–°é¡¹ç›®ä¼šéœ€è¦åˆ›å»ºå¾ˆå¤šç»„ä»¶ï¼Œæ ·å¼ï¼Œé¢œè‰²ç­‰ç­‰ã€‚ä½†æ˜¯ä»–åœ¨å·¥ç¨‹ç®¡ç†æ–¹é¢å…¶å®æ˜¯èµ°åœ¨å‰é¢çš„ï¼Œå› ä¸ºä½ æ‰€æœ‰çš„å·¥ä½œéƒ½ä¸ä¼šé‡å¤ï¼Œåé¢å¦‚æœå†æ¬¡å‡ºç°è¿™æ ·çš„ç»„ä»¶ï¼Œä½ åªéœ€è¦ä»ç»„ä»¶åº“é‡Œé¢ copy\&paste å³å¯ã€‚è¿™ç§æ–¹å¼ä¹Ÿä¿è¯ UI çš„é«˜è¿˜åŸåº¦ï¼Œå› ä¸ºæ‰€æœ‰çš„ç»„ä»¶ï¼Œæ ·å¼éƒ½æ˜¯é¢„å®šä¹‰çš„ï¼Œå¼€å‘è€…ä¸éœ€è¦èŠ±å¾ˆå¤šå¿ƒæ€åœ¨ UI å®ç°ä¸Šï¼Œé‡ç‚¹åœ¨å®ç° feature é€»è¾‘ä¸Šå³å¯ã€‚

### theme **ç³»ç»Ÿçš„å‘½åä¹ æƒ¯**

é¦–å…ˆæ¥çœ‹ä¸€æ®µ Now In Android é‡Œé¢çš„ colorschema å‘½åï¼Œè¿™æ˜¯ä¸€ä¸ªå®¹æ˜“è¢«å¾ˆå¤šäººå¿½ç•¥çš„ç»†èŠ‚ï¼Œä¸ªäººå»ºè®®å¦‚æœæ²¡æœ‰æ¥è§¦è¿‡çš„ä¸€å®šè¦å¤šç†è§£å­¦ä¹ ã€‚

```kt
// é¢œè‰²å®šä¹‰
internal val Blue10 = Color(0xFF001F28)
internal val Blue20 = Color(0xFF003544)
internal val Blue30 = Color(0xFF004D61)
internal val Blue40 = Color(0xFF006780)
internal val Blue80 = Color(0xFF5DD5FC)
internal val Blue90 = Color(0xFFB8EAFF)
internal val DarkGreen10 = Color(0xFF0D1F12)
internal val DarkGreen20 = Color(0xFF223526)
internal val DarkGreen30 = Color(0xFF394B3C)
internal val DarkGreen40 = Color(0xFF4F6352)
internal val DarkGreen80 = Color(0xFFB7CCB8)
...
// æ ·å¼å®šä¹‰
val DarkAndroidColorScheme = darkColorScheme(
    primary = Green80,
    onPrimary = Green20,
    primaryContainer = Green30,
    onPrimaryContainer = Green90,
    secondary = DarkGreen80,
    onSecondary = DarkGreen20,
    secondaryContainer = DarkGreen30,
    onSecondaryContainer = DarkGreen90,
    tertiary = Teal80,
    ...
)
// ä½¿ç”¨
NotificationDot(
            color = MaterialTheme.colorScheme.tertiary,
            modifier = Modifier.size(8.dp),
        )
```

å¾ˆå¤šåŒå­¦æ˜¯ä¸æ˜¯æœ‰ç–‘æƒ‘ï¼Œè¿™æ ·å†™æ˜¯ä¸æ˜¯ğŸ–Œï¸ğŸğŸ©âš½ï¼Œæ˜æ˜å¯ä»¥è¿™æ ·å†™çš„ MaterialTheme.colorScheme.DarkGreen10 ä¸ºä»€ä¹ˆè¿˜è¦å†å¤šæ­¤ä¸€ä¸¾ï¼Ÿ å’‹ä¸€å¬å¥½åƒæœ‰ç‚¹é“ç†ï¼Œä½†æ˜¯å¦‚æœæˆ‘è¦æ”¯æŒ light mode å‘¢ï¼Œè¯¥å¦‚ä½•æ˜¯å¥½å‘¢ï¼Ÿæ€»ä¸èƒ½ä½¿ç”¨ if else æ¥ç®¡ç†æ ·å¼å§ã€‚å…¶å®è¡Œä¸šå†…å¯¹äºç»„ä»¶æ ·å¼çš„å‘½åæ—©å°±æœ‰äº†ä¸€å¥—æˆç†Ÿçš„åŠæ³•äº†ï¼Œç°åœ¨ä¸šç•Œæ™®éçš„æ–¹å¼å«åš design tokenã€‚\
ä¸‹é¢çœ‹ä¸‹ [material design çš„ä»‹ç»](https://m3.material.io/foundations/design-tokens/overview)

```kt
-   Tokens point to style values like colors, fonts, and measurements
-   Use design tokens instead of hardcoded values
-   Each token is named for how or where itâ€™s used (for example,Â **md.fab.container.color**Â sets the container color for a FAB)
-   Even if a tokenâ€™s end value is changed, its name and use remain the same
-  ...
```

åŒæ—¶ä¹Ÿæ¨èä¸€äº›å…¶ä»–é“¾æ¥å¸Œæœ›å¤§å®¶ä»ä¸­å­¦ä¹ ï¼Œ[link1](https://www.uisdc.com/design-token)ï¼Œ[link2](https://semi.design/zh-CN/basic/tokens)
æ€»ç»“å‡ºæ¥ design token è¿™ç§å‘½åæ–¹å¼ä»¥ä½¿ç”¨æ–¹å¼æˆ–è€…ä½¿ç”¨åœ°ç‚¹å‘½åï¼Œè€Œä¸æ˜¯ç›´æ¥ hardcodeï¼Œè¿™æ ·æ–¹å¼æ›´ç¬¦åˆç°ä»£æ–¹æ¡ˆã€‚ä¸çŸ¥é“è®²äº†è¿™ä¹ˆå¤šï¼Œä½ æœ‰æ²¡æœ‰å¯¹ token design è¿™ç§ç°åœ¨ä¸»æµçš„è®¾è®¡æ–¹æ¡ˆæœ‰æ‰€äº†è§£ï¼Œå¦‚æœæœ‰ç–‘æƒ‘çš„åœ°æ–¹ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºã€‚

## CompositionLocal

ä¹‹æ‰€ä»¥è¦å•ç‹¬å¼€ä¸€èŠ‚æ¥è®² CompositionLocal å’Œ Themeæ˜¯å› ä¸ºæ¶‰åŠåˆ°çŸ¥è¯†ç‚¹æœ‰ç‚¹å¤šï¼Œè€Œä¸”è¿™å¯¹äºå¼€å‘è€…æ¥è¯´åˆæ˜¯ä¸€é¡¹ä¸å¯æˆ–ç¼ºçš„çŸ¥è¯†ã€‚æƒ³è¦äº†è§£ Theme é‚£ä¹ˆå¿…é¡»äº†è§£ CompositionLocal ç›¸å…³çŸ¥è¯†ã€‚

### composeï¼Œcomposableï¼Œcompositionï¼ŒcompositionLocal å‚»å‚»åˆ†ä¸æ¸…æ¥šï¼Ÿ

æˆ‘ä¹‹æ‰€ä»¥æŠ›å‡ºè¿™ä¸ªé—®é¢˜æ˜¯ä¸ºäº†å…ˆç»™å¤§å®¶å¯¹ compose æœ‰ä¸€ä¸ªæ•´ä½“çš„å°è±¡ï¼Œå½¢æˆä¸€ä¸ªç³»ç»Ÿçš„æ¦‚å¿µã€‚

*   **compose**ï¼šæ•´ä½“æ¡†æ¶ï¼Œç”¨äºæ„å»º UIã€‚

*   **composable**ï¼šæ ‡è®°å‡½æ•°ï¼Œä½¿å…¶æˆä¸ºå¯ç»„åˆçš„ UI ç»„ä»¶ã€‚ï¼ˆå½¢å®¹è¯å½“æ³¨è§£ï¼‰

*   **composition**ï¼šUI ç»„ä»¶çš„åŠ¨æ€æ ‘ç»“æ„ï¼Œè´Ÿè´£ç®¡ç† UI çš„æ›´æ–°ã€‚ï¼ˆcompose æ˜¯ä¸ªåŠ¨è¯ï¼Œæ‰§è¡Œå®Œçš„ç»“æœï¼Œä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼‰

*   **compositionLocal**ï¼šç”¨äºåœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®çš„æœºåˆ¶ã€‚

### compositionLocal è®¾è®¡çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ

ç”±äº compose å¤§é‡å€Ÿé‰´ï¼ˆæŠ„è¢­ï¼‰äº† react çš„æ–¹æ¡ˆï¼Œåœ¨è¿™é‡Œæˆ‘æ¨èå¤§å®¶çœ‹ä¸€ä¸‹ react çš„[æ–‡æ¡£](https://www.reactjs.cn/learn/passing-data-deeply-with-context#step-3-provide-the-context)ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ä¸ºäº†è§£å†³å±‚çº§è¿‡æ·±å¼•èµ·çš„ä¼ å€¼é—®é¢˜ï¼Œç”±äº compose ui æ¨èçš„æ–¹å¼**æ˜¾ç¤ºä¼ å€¼**ï¼Œè¿™ç§æ–¹æ³•åœ¨å•é¡µé¢åº”ç”¨ï¼Œä»¥åŠå…¶ä»–å¤æ‚é¡µé¢ä¼šå˜å¾—ååˆ†å¤æ‚ï¼Œç»´æŠ¤æ ·å¼ä¹Ÿä¼šå˜å¾—å¼‚å¸¸å¤æ‚ï¼Œäºæ˜¯ compositionLocal åº”è¿è€Œç”Ÿã€‚

### å¦‚ä½•å¿«é€Ÿç†è§£ CompositionLocalï¼Ÿ

ç›¸ä¿¡å¾ˆå¤šäººå’Œæˆ‘ä¸€æ ·çœ‹åˆ° CompositionLocal è¿™ä¸ªæ¦‚å¿µçš„æ—¶å€™ä¼šæœ‰ç–‘é—®ï¼Œä¸ºå•¥å‘½åå« compositionLocalï¼Ÿå¾ˆå¤šæ¡†æ¶é‡Œé¢çš„å‘½åéƒ½æ˜¯çº¦å®šä¿—æˆçš„ï¼Œå¾ˆå¤šçœ‹ç€å¹³å¹³æ— å¥‡çš„ä»£ç ï¼Œéƒ½æ˜¯æ— æ•°æ¬¡å·¥ç¨‹æ¼”è¿›çš„ç»“æœã€‚ç°åœ¨æˆ‘ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªè€æœ‹å‹ ThreadLocalï¼Œå¤§å®¶æ¯”ç…§ ThreadLocal æ¥ç†è§£ compositionLocal æ˜¯ä¸æ˜¯è¦å®¹æ˜“çš„å¤šï¼Ÿå¾ˆå®¹æ˜“å¯ä»¥çŸ¥é“ compositionLocal ä¹Ÿæ˜¯ç”¨æ¥ä¿å­˜ composition çš„æœ¬åœ°å˜é‡ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä¹Ÿæœ‰ä¸€ä¸ª CompositionLocalMap è¿™æ ·çš„ä¸œè¥¿å­˜åœ¨ï¼Ÿé‚£è‡ªç„¶ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚CompositionLocalMap æ˜¯ç”¨æ¥ä¿å­˜ CompositionLocal ï¼Œä½¿ç”¨ CompositionLocal\<Any?> ä¸º keyï¼Œä»–æ˜¯åŸºäº TrieNode å®ç°çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œæå¤§çš„é™ä½äº†æ ‘çš„æœç´¢å¤æ‚åº¦ã€‚å…³äº Trieï¼ˆå‰ç¼€æ ‘ï¼‰çš„ä»‹ç»å°±ä¸åœ¨è¿™é‡Œä»”ç»†å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å» [leetcode](https://leetcode.cn/problems/implement-trie-prefix-tree/description/) å°è¯•è‡ªå·±å®ç°ä¸€ä¸‹ï¼Œå¾ˆå®¹æ˜“å®ç°çš„ ğŸ˜„ã€‚

### å¦‚ä½•ä½¿ç”¨ CompositionLocalï¼Ÿ

CompositionLocal ä½¿ç”¨è·Ÿ React é‡Œé¢çš„ context éå¸¸åƒï¼Œåˆ†ä¸‰æ­¥èµ°ã€‚

1.  åˆ›å»º CompositionLocal
2.  ä½¿ç”¨ CompositionLocalProvider ä¸º CompositionLocal æä¾›å€¼
3.  ä½¿ç”¨ CompositionLocal
    å¤§å®¶å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼šåˆ›å»ºï¼Œåˆå§‹åŒ–ï¼Œä½¿ç”¨ã€‚ä¸‹é¢ç”¨ Now In Android ä»£ç å±•ç¤ºä¸€ä¸‹

```kt
// step 1
val LocalAnalyticsHelper = staticCompositionLocalOf<AnalyticsHelper> {
    // Provide a default AnalyticsHelper which does nothing. This is so that tests and previews
    // do not have to provide one. For real app builds provide a different implementation.
    NoOpAnalyticsHelper()
}

// step 2
CompositionLocalProvider(
    LocalAnalyticsHelper provides analyticsHelper,
    LocalTimeZone provides currentTimeZone,
) {
    NiaTheme(
        darkTheme = themeSettings.darkTheme,
        androidTheme = themeSettings.androidTheme,
        disableDynamicTheming = themeSettings.disableDynamicTheming,
    ) {
        NiaApp(appState)
    }
}

// step 3
val analyticsHelper = LocalAnalyticsHelper.current
```

è¿™é‡Œé¢æœ‰ä¸€ä¸ªç»†èŠ‚ï¼ŒCompositionLocal.current æ˜¯è·å–ç¦»ä»–æœ€è¿‘çš„çš„ CompositionLocalProvider æä¾›çš„ CompositionLocalã€‚è¿™æ„å‘³ç€ CompositionLocal å®é™…ä¸Šæ˜¯å¯ä»¥å­˜åœ¨å¤šä»½çš„ï¼Œä¸€ä¸ªæ ‘ç»“æ„ä¸­å¯èƒ½å­˜åœ¨å¤šä¸ª CompositionLocal å®ä¾‹ï¼Œæ•£å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šã€‚ä¸¾ä¸ªä¾‹å­æœ¬ä¾‹ä¸­ CompositionLocalProvider æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ staticCompositionLocalOf<AnalyticsHelper>ï¼Œä½†æ˜¯å­ç»„ä»¶å®Œå…¨æœ‰å¯èƒ½è‡ªå·±æä¾›ä¸€ä¸ªæ–°çš„ staticCompositionLocalOf<AnalyticsHelper>ï¼Œè¿™ç§åšæ³•æ˜¯å®Œå…¨å¯èƒ½çš„ã€‚ä¸è¿‡ä¸€èˆ¬ä¸å»ºè®®è¿™ä¹ˆåšï¼Œè¿™ä¹ˆæ“ä½œå¯èƒ½ä¼šä½¿å¾—ä»£ç ç»´æŠ¤å˜å¾—å›°éš¾ã€‚

### Taskï¼šcompositionLocalOf ä¸ staticCompositionLocalOf æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»–ä»¬å„æœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯ï¼Ÿ

è¿™ç®—æ˜¯ç•™ç»™å¤§å®¶çš„ä¸€ä¸ªå°ä»»åŠ¡ï¼Œå¸Œæœ›ä½ å¯ä»¥å…ˆè‡ªå·±æ€è€ƒä¸€ä¸‹ï¼Œç„¶åå†è·Ÿå®˜æ–¹æ–‡æ¡£å¯¹æ¯”ä¸€ä¸‹ï¼Œçœ‹çœ‹è‡ªå·±ç†è§£æ˜¯å¦æ­£ç¡®ã€‚

## Theme

### Theme çš„æ¦‚å¿µ

> ä¸€ä¸ªä¸»é¢˜é€šå¸¸ç”±è®¸å¤šå­ç³»ç»Ÿç»„æˆï¼Œè¿™äº›å­ç³»ç»Ÿç”¨äºå¯¹å¸¸è§çš„è§†è§‰æ¦‚å¿µå’Œè¡Œä¸ºæ¦‚å¿µè¿›è¡Œåˆ†ç»„ï¼Œå¯ä»¥ä½¿ç”¨å…·æœ‰ä¸»é¢˜å€¼çš„ç±»è¿›è¡Œå»ºæ¨¡

### ä¸¾ä¾‹è¯´æ˜

ä¸‹é¢ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦ MaterialTheme æ¥åšä¸¾ä¾‹è¯´æ˜

```kt
    @Composable
fun MaterialTheme(
    colorScheme: ColorScheme = MaterialTheme.colorScheme,
    shapes: Shapes = MaterialTheme.shapes,
    typography: Typography = MaterialTheme.typography,
    content: @Composable () -> Unit
) {
    val rememberedColorScheme =
        remember {colorScheme.copy()}
            .apply { updateColorSchemeFrom(colorScheme) }
    val selectionColors = rememberTextSelectionColors(rememberedColorScheme)
    CompositionLocalProvider(
        LocalColorScheme provides rememberedColorScheme,
        LocalShapes provides shapes,
        LocalTextSelectionColors provides selectionColors,
        LocalTypography provides typography
    ) {
        ProvideTextStyle(value = typography.bodyLarge, content = content)
    }
}

object MaterialTheme {
    val colorScheme: ColorScheme
        @Composable
        @ReadOnlyComposable
        @SuppressWarnings("HiddenTypeParameter", "UnavailableSymbol")
        get() = LocalColorScheme.current

    val typography: Typography
        @Composable @ReadOnlyComposable get() = LocalTypography.current

    val shapes: Shapes
        @Composable @ReadOnlyComposable get() = LocalShapes.current
}
    
```

é€šè¿‡ä¸Šé¢çš„ MaterialTheme ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–çš„ä¸»é¢˜ä¸»è¦æœ‰ é¢œè‰²ï¼Œå½¢çŠ¶ï¼Œæ’ç‰ˆ ä¸‰ä¸ªå­ç³»ç»Ÿç»„æˆï¼Œåœ¨ä¸»é¢˜ fun é‡Œé¢ä½¿ç”¨ compositionLocal çš„å°†è¿™äº›å­ç³»ç»Ÿä¸€èµ·æä¾›ç»™ä½œç”¨åŸŸé‡Œé¢çš„ composeã€‚ä¸€èˆ¬æ¥è¯´ Theme éƒ½ä¼šé€šè¿‡ object å¯¼å‡ºæ ·å¼æ–¹ä¾¿ä½¿ç”¨æ–¹è°ƒç”¨ï¼Œ å½“ç„¶ compose çš„ä¸»é¢˜çµæ´»åº¦å¾ˆé«˜ï¼Œä½ å®Œå…¨å¯ä»¥æ·»åŠ å¾ˆå¤šè‡ªå®šä¹‰ä¸»é¢˜ï¼Œè¯´åˆ°åº• compose çš„ theme å…¶å®æ˜¯ä¸€ç»„ compositionLocalsã€‚ä½ å¯ä»¥æŒ‰ç…§é¡¹ç›®éœ€è¦çµæ´»çš„å®šåˆ¶åŒ–ä½ çš„ä¸»é¢˜ï¼Œæ¯”å¦‚è¯´ colorschemeï¼Œä½ å®Œå…¨å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„å­ç³»ç»Ÿè‡ªå·±å‘½åå« fancy, ç„¶åä½ è‡ªå·±å®šä¹‰ compositionLocalï¼Œprovide ç»™ä½¿ç”¨æ–¹å³å¯ã€‚

### Theme ä½¿ç”¨æ­¥éª¤

ä¸€èˆ¬æ¥è¯´ Theme å®šä¹‰éµå¾ªä¸‹é¢ 3 ä¸ªä¸»è¦æ­¥éª¤

1.  å®šä¹‰å­ç³»ç»Ÿ
2.  ä½¿ç”¨ Theme æ–¹æ³•ç»„è£…å­ç³»ç»Ÿ
3.  ä½¿ç”¨ Theme object å¯¼å‡ºå­ç³»ç»Ÿ

### Now In Android ä¸­ Theme æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ

ç”±äºä»“åº“é‡Œé¢çš„ä»£ç è¾ƒé•¿ï¼Œæˆ‘ä¸å¥½ç›´æ¥ copy è¿‡æ¥ï¼Œå½±å“é˜…è¯»ä½“éªŒï¼Œæˆ‘åœ¨è¿™é‡Œæ”¾ä¸€ä¸ª[é“¾æ¥](https://github.com/android/nowinandroid/blob/main/core/designsystem/src/main/kotlin/com/google/samples/apps/nowinandroid/core/designsystem/theme/Theme.kt)ï¼Œå¯ä»¥ç‚¹å‡»è¿›å»æŸ¥çœ‹ä¸€ä¸‹ä»–çš„ Theme è®¾è®¡ã€‚\
Now In Android å¹¶æ²¡æœ‰ä½¿ç”¨ object å¯¼å‡º Themeï¼Œè¿™ä¸€ç‚¹è·Ÿå®˜æ–¹æ–‡æ¡£æ¨èçš„ä¸å¤ªä¸€æ ·ï¼Œæˆ‘ä¸ªäººæ˜¯ä¸å»ºè®®è¿™æ ·å†™çš„ï¼Œè¿™æ ·å†™ä¼šä½¿å¾—å¾ˆå¤šå­ç³»ç»Ÿåº”ç”¨å¾ˆå¥‡æ€ªï¼Œè®©ä½¿ç”¨æ–¹å¾ˆè¿·æƒ‘ï¼Œä¸‹é¢æˆ‘æ”¾ä»£ç åº“ä¸­çš„ä¸€æ®µä»£ç ï¼š

```kt
fun NiaGradientBackground(
   modifier: Modifier = Modifier,
   gradientColors: GradientColors = LocalGradientColors.current,
   content: @Composable () -> Unit,
)
```

é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬çœ‹åˆ°ä½¿ç”¨æ–¹ç›´æ¥è°ƒç”¨äº†å­ç³»ç»Ÿï¼Œè€Œä¸æ˜¯é€šè¿‡ Theme.gradient ç±»ä¼¼çš„æ–¹å¼æ¥å®ç°ï¼Œè¿™ç§ç›´æ¥å‘ä½¿ç”¨æ–¹æš´éœ²å­ç³»ç»Ÿçš„æ–¹å¼ï¼Œç€å®ä¼šè®©è°ƒç”¨æ–¹æ‘¸ä¸ç€å¤´è„‘ã€‚å¼€å‘è€…åº”è¯¥æŠŠé‡ç‚¹æ”¾åœ¨ Theme ä¸Šï¼Œå¦‚æœè¿™æ—¶å€™çªç„¶å‡ºç°ä¸€ä¸ªå­ç³»ç»Ÿæ•£è½åœ¨å››å¤„æ— ç–‘ä¼šç»™é˜…è¯»è¿˜æœ‰ä½¿ç”¨éƒ½å¸¦æ¥è´Ÿæ‹…ã€‚å½“ç„¶è¿™ä¹Ÿç ´åäº†å°è£…ï¼Œæˆ‘ä¸ªäººå¯¹æ­¤åšäº†ä¸€äº›ä¿®æ”¹ã€‚ä»£ç é“¾æ¥[ä¼ é€åœ°å€](https://github.com/android/nowinandroid/pull/1808/files#diff-a72250a640d53322e5eb10ff8cd0d4db01752b81687cda0daff3e5693b3e78b6)ï¼Œæ¬¢è¿åˆ†äº«äº¤æµä½ å¯¹ theme çš„è§è§£ã€‚

## æ€»ç»“

*   compositionLocal æ˜¯ä¸ºäº†è§£å†³å±‚çº§è¿‡é•¿ï¼Œä¼ é€’å‚æ•°ä¸æ˜“è€Œäº§ç”Ÿçš„ä¸€ç§çŠ¶æ€å…±äº«æ–¹æ¡ˆã€‚
*   Theme æ˜¯ä¸€ç»„ compositionLocal çš„ç»„åˆ
*   æœ¬æ–‡è¿˜ä»‹ç»äº†å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨ compositionLocalï¼ŒTheme

## æœ¬ç« å®Œã€‚è°¢è°¢è§‚çœ‹
